<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Paquetes</title>
    <link rel="stylesheet" href="style.css">
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, doc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAgc2LKUM5YOdi-yghM-oNX5P1rO3Fyt1M",
            authDomain: "gestion-paquetes-d27da.firebaseapp.com",
            projectId: "gestion-paquetes-d27da",
            storageBucket: "gestion-paquetes-d27da.appspot.com",
            messagingSenderId: "874859059548",
            appId: "1:874859059548:web:7be50c95de6d19c0e84999",
            measurementId: "G-MV0NTDC5D3"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);
        window.firestore = { db, collection, addDoc, getDocs, updateDoc, doc };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Gestión de Paquetes</h1>
        
        <div class="tabs">
            <button class="tab-button active" onclick="openTab('registro')">Registrar Paquete</button>
            <button class="tab-button" onclick="openTab('consulta')">Consultar Paquetes</button>
            <button class="tab-button" onclick="openTab('modificar')">Modificar Intentos</button>
        </div>
        
        <div id="registro" class="tab-content active">
            <h2>Registro de Nuevo Paquete</h2>
            <form id="formPaquete">
                <div class="form-group">
                    <label for="codigo">Código de pedido:</label>
                    <input type="text" id="codigo" required>
                </div>
                
                <div class="form-group">
                    <label>Método de pago:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="pago" value="De_contado" checked> De Contado</label>
                        <label><input type="radio" name="pago" value="Contraentrega"> Contraentrega</label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Tipo de envío:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="envio" value="Retiro en oficina" checked> Retiro en oficina</label>
                        <label><input type="radio" name="envio" value="Entrega en dirección"> Entrega en dirección</label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Tipo de contenido:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="contenido" value="Mercancía" checked> Mercancía</label>
                        <label><input type="radio" name="contenido" value="Documentos"> Documentos</label>
                    </div>
                </div>
                
                <div id="direccion-group" class="form-group hidden">
                    <label>Destino:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="destino" value="Zona" checked> Zona</label>
                        <label><input type="radio" name="destino" value="Fundacion"> Fundación</label>
                    </div>
                    
                    <div class="form-group">
                        <label for="direccion">Dirección completa:</label>
                        <textarea id="direccion" rows="3"></textarea>
                    </div>
                </div>
                
                <button type="submit" class="btn">Guardar</button>
            </form>
        </div>
        
        <div id="consulta" class="tab-content">
            <h2>Consulta de Paquetes</h2>
            <div class="form-group">
                <label for="filtro-repartidor">Filtrar por repartidor:</label>
                <select id="filtro-repartidor">
                    <option value="Todos">Todos</option>
                    <option value="Repartidor 1">Repartidor 1</option>
                    <option value="Repartidor 2">Repartidor 2</option>
                    <option value="Repartidor 3">Repartidor 3</option>
                    <option value="Repartidor 4">Repartidor 4</option>
                    <option value="Repartidor 5">Repartidor 5</option>
                </select>
            </div>
            
            <div class="filtros-container">
                <div class="form-group">
                    <label for="filtro-codigo">Buscar por código:</label>
                    <input type="text" id="filtro-codigo" placeholder="Ingrese código">
                </div>
                
                <div class="form-group">
                    <label for="filtro-estado">Filtrar por estado:</label>
                    <select id="filtro-estado">
                        <option value="Todos">Todos</option>
                        <option value="Pendiente">Pendiente</option>
                        <option value="Entregado">Entregado</option>
                        <option value="Digitalizado">Digitalizado</option>
                        <option value="Devolución">Devolución</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="filtro-destino">Filtrar por destino:</label>
                    <select id="filtro-destino">
                        <option value="Todos">Todos</option>
                        <option value="Zona">Zona</option>
                        <option value="Fundacion">Fundación</option>
                        <option value="No aplica">No aplica</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="filtro-fecha">Filtrar por fecha:</label>
                    <select id="filtro-fecha-tipo">
                        <option value="todas">Todas las fechas</option>
                        <option value="antes">Antes de</option>
                        <option value="despues">Después de</option>
                        <option value="igual">Igual a</option>
                    </select>
                    <input type="date" id="filtro-fecha" placeholder="DD/MM/AAAA">
                </div>
                
                <button onclick="aplicarFiltros()" class="btn">Aplicar Filtros</button>
                <button onclick="limpiarFiltros()" class="btn btn-secondary">Limpiar Filtros</button>
                <button onclick="exportarExcelFiltrado()" class="btn btn-export">Exportar Excel</button>
            </div>

            <div class="comparar-container">
                <h3>Comparar con archivo Excel</h3>
                <input type="file" id="archivo-excel" accept=".xlsx,.xls" />
                <button onclick="compararExcel()" class="btn">Comparar archivo</button>
                <div id="resultado-comparacion"></div>
            </div>

            
            <div class="resumen">
                <p>Total paquetes: <span id="total-paquetes">0</span></p>
                <p>Pendientes: <span id="pendientes">0</span></p>
                <p>Entregados: <span id="entregados">0</span></p>
                <p>Digitalizados: <span id="digitalizados">0</span></p>
                <p>Devoluciones: <span id="devoluciones">0</span></p>
            </div>
            
            <table id="tabla-paquetes">
                <thead>
                    <tr>
                        <th>Código</th>
                        <th>Dirección</th>
                        <th>Repartidor</th>
                        <th>Destino</th>
                        <th>Intentos</th>
                        <th class="fecha-col">Fecha Registro</th>
                        <th>Estado</th>
                        <th>Acción</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        
        <div id="modificar" class="tab-content">
            <h2>Modificar Intentos de Entrega</h2>
            <div class="form-group">
                <label for="buscar-codigo">Ingrese código de pedido:</label>
                <input type="text" id="buscar-codigo">
                <button onclick="buscarPaquete()" class="btn">Buscar</button>
            </div>
            
            <div id="info-paquete" class="hidden">
                <h3>Información del Paquete</h3>
                <p>Código: <span id="info-codigo"></span></p>
                <p>Dirección: <span id="info-direccion"></span></p>
                <p>Intentos actuales: <span id="info-intentos"></span></p>
                
                <div class="form-group">
                    <label for="nuevos-intentos">Nuevo número de intentos:</label>
                    <input type="number" id="nuevos-intentos" min="0" max="3">
                    <button onclick="actualizarIntentos()" class="btn">Actualizar</button>
                </div>
                
                <p class="nota">Nota: Si establece 0 intentos, el estado cambiará a "Devolución"</p>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>